---
layout: post
title: Pentesting Port - 21 - FTP 
tags: [Pentesting, port21, hacking, ftp]
image: https://ne0wn.github.io/assets/img/python_tips/python-tips-logo.png
share-img: https://ne0wn.github.io/assets/img/python_tips/python-tips-logo.png
---

The File Transfer Protocol (FTP) is a standard network protocol used for the transfer of computer files between a client and server on a computer network.
It is a plain-text protocol that uses as new line character <i>0x0d 0x0a</i> so sometimes you need to connect using <i>telnet</i> or <i>nc -C</i>.

<center><img src="/assets/img/python_tips/py-joke.jpg" alt="Python Joke"></center>

<br>

<b>Default Port:</b> 21

```shell
PORT   STATE SERVICE
21/tcp open  ftp
```
<br>
<b>Enumeration:</b>

Banner Grabbing

```bash
nc -vn <IP> 21
openssl s_client -connect crossfit.htb:21 -starttls ftp #Get certificate if any
```

Connect to FTP using starttls

```shell
    lftp
    lftp :~> set ftp:ssl-force true
    lftp :~> set ssl:verify-certificate no
    lftp :~> connect 10.10.10.208
    lftp 10.10.10.208:~> login                       
    Usage: login <user|URL> [<pass>]
    lftp 10.10.10.208:~> login username Password
```
<br>

<b>Unauthenticated Enumeration:</b>

You can us the commands <i>HELP</i> and <i>FEAT</i> to obtain some information of the FTP server:

```bash

HELP
214-The following commands are recognized (* =>'s unimplemented):
214-CWD     XCWD    CDUP    XCUP    SMNT*   QUIT    PORT    PASV    
214-EPRT    EPSV    ALLO*   RNFR    RNTO    DELE    MDTM    RMD     
214-XRMD    MKD     XMKD    PWD     XPWD    SIZE    SYST    HELP    
214-NOOP    FEAT    OPTS    AUTH    CCC*    CONF*   ENC*    MIC*    
214-PBSZ    PROT    TYPE    STRU    MODE    RETR    STOR    STOU    
214-APPE    REST    ABOR    USER    PASS    ACCT*   REIN*   LIST    
214-NLST    STAT    SITE    MLSD    MLST    
214 Direct comments to root@drei.work
FEAT
211-Features:
 PROT
 CCC
 PBSZ
 AUTH TLS
 MFF modify;UNIX.group;UNIX.mode;
 REST STREAM
 MLST modify*;perm*;size*;type*;unique*;UNIX.group*;UNIX.mode*;UNIX.owner*;
 UTF8
 EPRT
 EPSV
 LANG en-US
 MDTM
 SSCN
 TVFS
 MFMT
 SIZE
211 End
```
<br>

<b>Connections:</b>

In Active FTP the FTP client first initiates the control connection from its port N to FTP Servers command port â€“ port 21. 

The client then listens to port N+1 and sends the port N+1 to FTP Server. 

FTP Server then initiates the data connection, from its port M to the port N+1 of the FTP Client.

But, if the FTP Client has a firewall setup that controls the incoming data connections from outside, then active FTP may be a problem. 

And, a feasible solution for that is Passive FTP.

In Passive FTP, the client initiates the control connection from its port N to the port 21 of FTP Server. 

After this, the client issues a passv comand. The server then sends the client one of its port number M. And the client initiates the data connection from its port P to port M of the FTP Server.

<br>

<b>Anonymous Login:</b>

* anonymous : anonymous

* anonymous :

* ftp : ftp

```shell
  ftp <IP>
>anonymous
>anonymous
>ls -a # List all files (even hidden) (yes, they could be hidden)
>binary #Set transmission to binary instead of ascii
>ascii #Set transmission to ascii instead of binary
>bye #exit
```
<br>

<b>Bruteforcing:</b>

A few useful wordlists for bruteforcing SSH have been provided below within the references section.

<br>
<b>Nmap:</b>

Anon login and bounce FTP checks are perform by default by nmap with -sC option.

<br>

<b>Shodan:</b>

```shell
    ftp
    port:21

```

<br>

<b>Browser Connection:</b>

You can connect to a FTP server using a browser (like Firefox) using a URL like:

```bash
    ftp://anonymous:anonymous@10.10.10.98
```

Note that if a web application is sending data controlled by a user directly to a FTP server you can send double URL encode %0d%0a (in double URL encode this is %250d%250a) bytes and make the FTP server perform arbitrary actions. One of this possible arbitrary actions is to download content from a users controlled server, perform port scanning or try to talk to other plain-text based services (like http).
<br>

<b>Download All Files From FTP:</b>

```shell
wget -m ftp://anonymous:anonymous@10.10.10.98 #Donwload all
wget -m --no-passive ftp://anonymous:anonymous@10.10.10.98 #Download all
```
<br>

<b>Config Files:</b>

```shell
ftpusers
ftp.conf
proftpd.conf
```
<br>

<b>References:</b>

[FTP Bounce Attack](https://www.thesecuritybuddy.com/vulnerabilities/what-is-ftp-bounce-attack/)
<br>

[Seclists](https://github.com/danielmiessler/SecLists/blob/master/Passwords/Default-Credentials/ftp-betterdefaultpasslist.txt)
<br>

Thank you for reading.